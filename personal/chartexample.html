<script>
    document.addEventListener("DOMContentLoaded", function () {
        const chartData = {
            monthly: {
                categories: [
                    "Jan",
                    "Feb",
                    "Mar",
                    "Apr",
                    "May",
                    "Jun",
                    "Jul",
                    "Aug",
                    "Sep",
                    "Oct",
                    "Nov",
                    "Dec",
                ],
                series: [
                    {
                        name: "Clinics Created",
                        data: [3, 5, 4, 6, 7, 8, 6, 9, 7, 10, 12, 14],
                    },
                    {
                        name: "Clinic Admin Accounts",
                        data: [2, 4, 3, 5, 6, 6, 5, 7, 6, 8, 9, 11],
                    },
                    {
                        name: "System Users Onboarded",
                        data: [
                            180, 260, 220, 310, 340, 420, 460, 510, 580, 640,
                            720, 810,
                        ],
                    },
                ],
            },
        };

        // Scale System Users for visibility
        const maxSmall = Math.max(
            ...chartData.monthly.series[0].data.concat(
                chartData.monthly.series[1].data,
            ),
        );
        const scaleFactor =
            maxSmall / Math.max(...chartData.monthly.series[2].data);
        const scaledUsers = chartData.monthly.series[2].data.map(
            (val) => val * scaleFactor,
        );

        var options = {
            chart: {
                type: "bar",
                height: 250,
                stacked: true,
                toolbar: {
                    show: false,
                },
            },
            plotOptions: {
                bar: {
                    horizontal: false,
                    columnWidth: "30%",
                    borderRadius: 3,
                },
            },
            series: [
                chartData.monthly.series[0],
                chartData.monthly.series[1],
                {
                    name: "System Users Onboarded",
                    data: scaledUsers,
                },
            ],
            colors: [
                "rgba(59,40,204,0.85)",
                "rgba(30,144,255,0.85)",
                "rgba(0,209,209,0.85)",
            ],
            dataLabels: {
                enabled: false,
            },
            stroke: {
                show: false,
            },
            xaxis: {
                categories: chartData.monthly.categories,
            },
            yaxis: {
                labels: {
                    formatter: function (val) {
                        if (val >= 1000) return (val / 1000).toFixed(1) + "K";
                        return Math.round(val);
                    },
                },
            },
            tooltip: {
                shared: false, // <-- show only hovered part
                intersect: true,
                y: {
                    formatter: function (val, { seriesIndex, dataPointIndex }) {
                        if (seriesIndex === 2) {
                            return (
                                chartData.monthly.series[2].data[
                                    dataPointIndex
                                ] + " users"
                            );
                        }
                        return chartData.monthly.series[seriesIndex].data[
                            dataPointIndex
                        ];
                    },
                },
            },
            legend: {
                position: "bottom",
                horizontalAlign: "center",
            },
        };

        var chart = new ApexCharts(
            document.querySelector("#system-activity-chart"),
            options,
        );
        chart.render();
    });

    // Superadmin Chart top
    document.addEventListener("DOMContentLoaded", function () {
        function miniBarChart(selector, data, color) {
            new ApexCharts(document.querySelector(selector), {
                chart: {
                    type: "bar",
                    height: 54,
                    sparkline: {
                        enabled: true,
                    },
                },
                series: [
                    {
                        data: data,
                    },
                ],
                colors: [color],
                plotOptions: {
                    bar: {
                        columnWidth: "60%",
                        borderRadius: 2,
                    },
                },
                tooltip: {
                    enabled: false,
                },
            }).render();
        }

        function miniAreaChart(selector, data, color) {
            new ApexCharts(document.querySelector(selector), {
                chart: {
                    type: "area",
                    height: 54,
                    sparkline: {
                        enabled: true,
                    },
                },
                series: [
                    {
                        data: data,
                    },
                ],
                stroke: {
                    width: 2,
                    curve: "smooth",
                },
                fill: {
                    opacity: 0.3,
                },
                colors: [color],
                tooltip: {
                    enabled: false,
                },
            }).render();
        }

        // Charts
        miniBarChart("#chart-clinics", [40, 15, 60, 15, 90, 20, 70], "#2e37a4");
        miniAreaChart("#chart-admins", [20, 45, 30, 60, 40, 70, 50], "#f36c3d");
        miniBarChart("#chart-users", [80, 35, 50, 45, 35, 60, 50], "#06aed4");
        miniAreaChart(
            "#chart-revenue",
            [100, 120, 110, 140, 130, 160, 180],
            "#28c76f",
        );
    });
</script>
